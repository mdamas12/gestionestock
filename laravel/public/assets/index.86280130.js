import{_ as c,J as m,U as V,S as p,f as r,L as i,F as y,R as n,ab as v,O as D,K as f,M as b}from"./index.6588ad1a.js";import{Q as u,a as U}from"./QCard.613286a3.js";import{Q as w,a as k,b as E,d as C,c as Q}from"./QCardActions.061aa7e7.js";import{Q as q}from"./scroll.8eca6a3c.js";import{Q as L}from"./QPage.ef8fdd8a.js";import{api as g}from"./axios.95274087.js";import"./QItem.3f39de37.js";const x={data(){return{token:"Bearer "+localStorage.getItem("authToken"),userList:[],usuer:"",userData:[],rolesList:[],dialogVisible:!1,isEditMode:!1,columns:[{name:"name",label:"Nombre",align:"left",field:l=>l.name},{name:"email",label:"email",align:"left",field:l=>l.email},{name:"roles",label:"Role",align:"left",field:l=>l.roles[0].name},{name:"actions",label:"Actions",align:"center"}],pagination:{rowsPerPage:5}}},computed:{},methods:{loadUsers(){var l,a;try{g.get("api/users/list",{headers:{Authorization:this.token}}).then(t=>{this.userList=t.data.data})}catch(t){this.$q.notify({type:"negative",message:((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||"Error al obtener usuarios"})}},OperNewUser(){this.isEditMode=!1,this.userData={},this.dialogVisible=!0},OperEditUser(l){this.user=l,this.isEditMode=!0,this.userData={...l},this.userData.role={label:l.roles[0].name,value:l.roles[0].name},this.dialogVisible=!0},registerUser(){var l,a,t,d;if(this.isEditMode==!0){let s={name:this.userData.name,email:this.userData.email,role:this.userData.role.value};try{g.put("api/users/user-update/"+this.user.id,s,{headers:{Authorization:this.token}}).then(o=>{this.dialogVisible=!1,this.$q.notify({type:"positive",message:"El usuario ha sido actualizado!"}),this.loadUsers()})}catch(o){this.$q.notify({type:"negative",message:((a=(l=o.response)==null?void 0:l.data)==null?void 0:a.message)||"Error al actualizar usuario"})}}else{if(this.userData.password!=this.userData.PasswordConfirm){alert("La Confirmacion no coincide!");return}this.userData.password.length<8&&alert("la contrase\xF1a debe tener al menos 8 caracteres! ");let s={name:this.userData.name,email:this.userData.email,password:this.userData.password,role:this.userData.role.value};try{g.post("api/auth/register",s,{headers:{Authorization:this.token}}).then(o=>{this.dialogVisible=!1,this.$q.notify({type:"positive",message:"El usuario ha sido registrado!"}),this.loadUsers()})}catch(o){this.$q.notify({type:"negative",message:((d=(t=o.response)==null?void 0:t.data)==null?void 0:d.message)||"Error al Crear usuario"})}}},deleteUser(){alert("ok ok")},searchUser(){alert("ok ok")}},mounted(){this.loadUsers(),this.rolesList=[{label:"administrator",value:"administrator"},{label:"Vendedor",value:"seller"},{label:"Tecnico",value:"technical"}]}},M={style:{width:"70%",height:"80%"},class:"bg-white rounded"},N={class:"text-h6"};function B(l,a,t,d,s,o){return m(),V(y,null,[a[11]||(a[11]=p("h5",{class:"q-ml-md"},"Productos",-1)),r(L,{class:"custon-page"},{default:i(()=>[r(n,{onClick:a[0]||(a[0]=e=>o.OperNewUser()),label:"Nuevo uUsiario",color:"primary",class:"q-mb-md"}),r(u,{modelValue:s.usuer,"onUpdate:modelValue":a[1]||(a[1]=e=>s.usuer=e),label:"Buscar usuario",debounce:"300",class:"q-mb-md",onKeydown:a[2]||(a[2]=v(e=>o.searchUser(),["enter"]))},null,8,["modelValue"]),r(w,{rows:s.userList,columns:s.columns,"row-key":"id",pagination:s.pagination,onRequest:o.loadUsers,"rows-per-page-options":[5,10,15]},{"body-cell-actions":i(e=>[r(k,{props:e},{default:i(()=>[r(n,{flat:"",label:"Edit",color:"primary",onClick:h=>o.OperEditUser(e.row)},null,8,["onClick"]),r(n,{flat:"",label:"Delete",color:"negative",onClick:h=>o.deleteUser(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","onRequest"]),r(E,{modelValue:s.dialogVisible,"onUpdate:modelValue":a[10]||(a[10]=e=>s.dialogVisible=e)},{default:i(()=>[p("div",M,[r(U,null,{default:i(()=>[r(q,null,{default:i(()=>[p("div",N,D(s.isEditMode?"Editar Usuario":"Crear Usuario"),1),r(u,{modelValue:s.userData.name,"onUpdate:modelValue":a[3]||(a[3]=e=>s.userData.name=e),label:"Nombre",rules:[e=>!!e||"El nombre  es obligatorio"],required:""},null,8,["modelValue","rules"]),r(u,{modelValue:s.userData.email,"onUpdate:modelValue":a[4]||(a[4]=e=>s.userData.email=e),label:"Email",rules:[e=>!!e||"El email  es obligatorio"],required:""},null,8,["modelValue","rules"]),r(C,{modelValue:s.userData.role,"onUpdate:modelValue":a[5]||(a[5]=e=>s.userData.role=e),options:s.rolesList,label:"Selecciona una opci\xF3n","option-label":"label","option-value":"value",outlined:"",rules:[e=>!!e||"El role es obligatoria"]},null,8,["modelValue","options","rules"]),s.isEditMode==!1?(m(),f(u,{key:0,modelValue:s.userData.password,"onUpdate:modelValue":a[6]||(a[6]=e=>s.userData.password=e),label:"Contrase\xF1a",type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],outlined:""},null,8,["modelValue","rules"])):b("",!0),s.isEditMode==!1?(m(),f(u,{key:1,modelValue:s.userData.PasswordConfirm,"onUpdate:modelValue":a[7]||(a[7]=e=>s.userData.PasswordConfirm=e),label:"confirmar contrase\xF1a",type:"password",rules:[e=>!!e||"La contrase\xF1a es obligatoria"],outlined:""},null,8,["modelValue","rules"])):b("",!0)]),_:1}),r(Q,null,{default:i(()=>[r(n,{flat:"",label:"Cancel",onClick:a[8]||(a[8]=e=>{this.dialogVisible=!1})}),r(n,{flat:"",label:"Guardar",color:"primary",onClick:a[9]||(a[9]=e=>o.registerUser())})]),_:1})]),_:1})])]),_:1},8,["modelValue"])]),_:1})],64)}var K=c(x,[["render",B]]);export{K as default};
